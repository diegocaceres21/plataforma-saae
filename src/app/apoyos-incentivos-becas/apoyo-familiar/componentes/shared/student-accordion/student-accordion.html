<div class="bg-white rounded-2xl shadow-md border border-gray-100 overflow-hidden transition-all duration-300 hover:shadow-xl hover:border-gray-200 group">
  
  <!-- Accordion Header -->
  <div class="px-6 py-4 cursor-pointer transition-all duration-300 relative"
       [ngClass]="{
         'bg-gradient-to-r from-orange-100 to-red-100 border-l-4 border-orange-500': isPlanPlus(),
         'hover:bg-gradient-to-r hover:from-gray-50 hover:to-blue-50/30': !isPlanPlus(),
         'hover:from-orange-200 hover:to-red-200': isPlanPlus()
       }"
       (click)="onToggleAccordion()">
    
    <!-- Gradient overlay for active state -->
    <div class="absolute inset-0 transition-opacity duration-300 group-hover:opacity-100" 
         [class.opacity-100]="isExpanded"
         [class.bg-gradient-to-r]="!isPlanPlus()"
         [class.from-blue-900/5]="!isPlanPlus()"
         [class.to-yellow-400/5]="!isPlanPlus()"
         [class.opacity-0]="!isPlanPlus()"></div>
    
    <div class="flex items-center justify-between relative z-10">
      <!-- Student Header Info Component -->
      <app-student-header-info 
        [registro]="registro"
        [showManualOrderIndicator]="showManualOrderIndicator"
        [isInTieGroup]="isInTieGroup"
        [materias]="materias"
        (openMaterias)="openMateriasModal()">
      </app-student-header-info>

      <!-- Expand/Collapse Icon -->
      <div class="ml-6 flex-shrink-0">
        <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center transition-all duration-300 group-hover:bg-gray-200"
             [class.bg-blue-100]="isExpanded"
             [class.group-hover:bg-blue-200]="isExpanded">
          <svg 
            class="w-5 h-5 transition-all duration-300"
            [class.rotate-180]="isExpanded"
            [class.text-blue-600]="isExpanded"
            [class.text-gray-500]="!isExpanded"
            fill="none" 
            stroke="currentColor" 
            viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"></path>
          </svg>
        </div>
      </div>
    </div>
  </div>

  <!-- Accordion Content -->
  @if (isExpanded) {
    <div class="border-t border-gray-100 bg-gradient-to-br from-gray-50/50 to-blue-50/30">
      <div class="p-8">
        <!-- Payment Plans Display Component -->
        <app-payment-plans-display 
          [registro]="registro"
          [showBothPlans]="showFullPlans">
        </app-payment-plans-display>
      </div>
    </div>
  }
</div>

<!-- Materias Modal - Outside accordion to avoid z-index issues -->
<app-materias-modal
  [isOpen]="showMateriasModal"
  [materias]="materias"
  [nombreEstudiante]="registro.nombre_estudiante || ''"
  [totalUVE]="registro.total_creditos || 0"
  (closeModal)="closeMateriasModal()">
</app-materias-modal>